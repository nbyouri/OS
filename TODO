rewrite cleanup function to handle output file as well but never delete anything from the client.

cleanup the main 


